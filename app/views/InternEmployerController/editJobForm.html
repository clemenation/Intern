#{extends 'main.html' /}
#{set title: 'Edit Job' /}

#{navigationBar /}

<h1>Intern/Employer</h1>

#{ifErrors}
	<h1>Oops...</h1>
	#{errors}
		<li>${error}</li>
	#{/errors}
#{/ifErrors}

#{form @InternEmployerController.editJob(job.id)}
	<div>
		Name: <input type="text" name="job.name" value="#{ifErrors}${flash['job.name']}#{/ifErrors}#{else}${job.name}#{/else}" />
		<span class="error">#{error 'job.name' /}</span>
	</div>
	<div>
		Required Work Experience: <input type="text" name="job.requiredWorkExperience" value="#{ifErrors}${flash['job.requiredWorkExperience']}#{/ifErrors}#{else}${job.requiredWorkExperience}#{/else}" />
		<span class="error">#{error 'job.requiredWorkExperience' /}</span>
	</div>
	<div>
		Description: <textarea type="text" name="job.description">#{ifErrors}${flash['job.description']}#{/ifErrors}#{else}${job.description}#{/else}</textarea>
		<span class="error">#{error 'job.description' /}</span>
	</div>
	<div>
		Required Education:
		<div>
			Study Years: <input type="text" name="job.requiredEducation.studyYears"
				value="#{ifErrors}${flash['job.requiredEducation.studyYears']}#{/ifErrors}#{else}${job.requiredEducation.studyYears}#{/else}" /> 
				<span class="error">#{error 'job.requiredEducation.studyYears' /}</span>
		</div>
		<div>
			GPA: <input type="text" name="job.requiredEducation.gpa"
				value="#{ifErrors}${flash['job.requiredEducation.gpa']}#{/ifErrors}#{else}${job.requiredEducation.gpa}#{/else}" /> <span class="error">#{error
				'job.requiredEducation.gpa' /}</span>
		</div>
		<div>
			College: <input type="text" name="job.requiredEducation.college"
				value="#{ifErrors}${flash['job.requiredEducation.college']}#{/ifErrors}#{else}${job.requiredEducation.college}#{/else}" /> <span class="error">#{error
				'job.requiredEducation.college' /}</span>
		</div>
		<div>
			Major: 
				<select name="job.requiredEducation.major.id">
					#{list items:models.InternMajor.all().fetch(), as:'major'}
						<option value=${major.id}
							#{ifErrors}
								#{if Long.parseLong(flash['job.requiredEducation.major.id']) == major.id}
									selected=true
								#{/if}
							#{/ifErrors}
							#{elseif job.requiredEducation.major?.id == major.id}
								selected=true
							#{/elseif}
						>${major}</option>
					#{/list}
				</select>
		</div>
	</div>
	<div>
		Contact Info:
		<span class="error">#{error 'contactInfo' /}</span>
		<div>
			Contact email: <input type="text" name="job.contactInfo.contactEmail" value="#{ifErrors}${flash['job.contactInfo.contactEmail']}#{/ifErrors}#{else}${employer.contactInfo.contactEmail}#{/else}" />
			<span class="error">#{error 'job.contactInfo.contactEmail' /}</span>
		</div>
		<div>
			Mobile: <input type="text" name="job.contactInfo.mobile" value="#{ifErrors}${flash['job.contactInfo.mobile']}#{/ifErrors}#{else}${employer.contactInfo.mobile}#{/else}" />
			<span class="error">#{error 'job.contactInfo.mobile' /}</span>
		</div>
		<div>
			Phone: <input type="text" name="job.contactInfo.phone" value="#{ifErrors}${flash['job.contactInfo.phone']}#{/ifErrors}#{else}${employer.contactInfo.phone}#{/else}" />
			<span class="error">#{error 'job.contactInfo.phone' /}</span>
		</div>
		<div>
			City: <select id="citySelect" name="job.contactInfo.address.city.id">
				#{list items:models.InternCity.all().fetch(), as:'city'}
					<option value=${city.id} 
						#{ifErrors}
							#{if Long.parseLong(flash['job.contactInfo.address.city.id'])==city.id}
								selected=true
							#{/if}
						#{/ifErrors}
						#{elseif job.contactInfo.address.city?.id==city.id}
							selected=true
						#{/elseif}
					>${city}</option>
				#{/list}
			</select>
		</div>
		<div>
			District: <select id="districtSelect" name="job.contactInfo.address.district.id">
				#{list items:districts, as:'district'}
					<option value=${district.id}
						#{ifErrors}
							#{if Long.parseLong(flash['job.contactInfo.address.district.id']) == district.id}
								selected=true
							#{/if}
						#{/ifErrors}
						#{elseif job.contactInfo.address.district?.id == district.id}
							selected=true
						#{/elseif}		
						>${district.name}</option>			
				#{/list}
			</select>
		</div>
	</div>
	<div>
		Languages: 
			<select multiple="yes" name="job.requiredLanguages.id">
				#{list items:models.InternLanguage.all().fetch(), as:'language'}
					<option value=${language.id}
						#{if job.requiredLanguages.contains(models.InternLanguage.findById(language.id))}
							selected=true
						#{/if}
					>${language}</option>
				#{/list}
			</select>
	</div>
	
	<div>
		<input type="submit" value="Apply change" />
	</div>

	<script type="text/javascript">
		var districtAction = #{jsAction @Application.districtsForCity(':cityId') /}
		
		$('#citySelect').change(function() {
			$.get(districtAction({cityId: $('#citySelect').val()}), function(districts) {	
				$('#districtSelect option').remove();
				$.each(districts, function(index, district) {
					$("#districtSelect").append('<option value="' + district.id + '">' + district.name + "</option>");
					});
				});
		});
	</script>
	
#{/form}

#{if job.canDelete()}
<a href="@{InternEmployerController.deleteJob(job.id)}"><h3>Delete Job</h3></a>
#{/if}