*{ You can use plain selenium command using the selenium tag }*

#{fixture delete:'all', load:'dungnguyendata.yml' /}

#{selenium}
	clearSession()
	
	// Open login page
	open('/')
	assertTextPresent('Or register as Job Seeker & Employer')
	
	// Login as job seeker
	type('username', 'nguyentuandung2991@gmail.com')
	type('password', 'dungnguyen')
	clickAndWait('css=input[type=submit]')
	assertTextPresent('Admin')
	assertTextPresent('Logout')
	assertTextPresent('Intern/Job Seeker')
	assertTextPresent('Suitable Jobs')
	assertTextPresent('Hoang Tran's 1st Job for Dung Nguyen's 1st Resume')
	assertTextPresent('Point: +2.0 -0.0')
#{/selenium}

#{selenium 'Test Profile'}
	clickAndWait('link=Me')
	assertTitle('Nguyen Tuan Dung')
	assertTextPresent('Profile')
	assertTextPresent('edit')
	assertTextPresent('Email: nguyentuandung2991@gmail.com')
	assertTextPresent('Resumes')
	assertTextPresent('Dung Nguyen's 3rd Resume')
	assertTextPresent('Applications')
	assertTextPresent('nguyentuandung2991@gmail.com's Dung Nguyen's 2nd Resume to hoangtran@gmail.com's Hoang Tran's 1st Job')
#{/selenium}

#{selenium 'Test View All Resume'}
	clickAndWait('link=view all')
	assertTextPresent('Resumes')
	assertTextPresent('Dung Nguyen's 3rd Resume')
	assertTextPresent('Dung Nguyen's 2nd Resume')
	assertTextPresent('Dung Nguyen's 1st Resume')
#{/selenium}

#{selenium 'Test View Resume'}
	clickAndWait('link=Dung Nguyen's 1st Resume')
	assertTitle('Dung Nguyen's 1st Resume')
	verifyTextPresent('Work experience: 2')
	verifyTextPresent('Suitable Jobs')
	verifyTextPresent('Hoang Tran's 1st Job for Dung Nguyen's 1st Resume')
	
	// Open a null resume, should go back to resume's index
	open('@{InternJobSeekerController.viewResume(0)}')
	assertTextPresent('Suitable Jobs')
#{/selenium}

#{selenium 'Test View Job'}
	clickAndWait('link=Hoang Tran's 1st Job for Dung Nguyen's 1st Resume')
	assertTitle('Hoang Tran's 1st Job')
	verifyTextPresent('Posted at: 2012-04-04 07:00:00.0')
	verifyTextPresent('Required work experience: 2')
	
	// There should be list of resumes
	verifyTextPresent('Your resume's points')
	verifyTextPresent('Dung Nguyen's 1st Resume')
	
	// There should be list of applied resumes
	verifyTextPresent('Your resumes that applied to this job')
	
	// Open a null job, should go back to job seeker's index
	open('@{InternJobSeekerController.viewJob(0)}')
	assertTextPresent('Suitable Jobs')
#{/selenium}

#{selenium 'Test Apply Job'}
	// Go to job page
	clickAndWait('link=Hoang Tran's 1st Job for Dung Nguyen's 1st Resume')
	assertTitle('Hoang Tran's 1st Job')
	
	// Click apply button, should open apply page
	clickAndWait('link=Apply')
	assertTitle('Apply Hoang Tran's 1st Job')
	
	// Should apply ok and go to application page
	type('application.message', 'Apply 1')
	clickAndWait('css=input[type=submit]')
	assertTitle('View Application')
	assertTextPresent('Apply 1')
	
	// Go to job page
	open('/')
	clickAndWait('link=Hoang Tran's 1st Job for Dung Nguyen's 1st Resume')
	assertTitle('Hoang Tran's 1st Job')
	
	// Click apply button, should open apply page
	clickAndWait('link=Apply')
	assertTitle('Apply Hoang Tran's 1st Job')
	
	// Should apply ok and go to application page
	type('application.message', 'Apply 2')
	clickAndWait('css=input[type=submit]')
	assertTitle('View Application')
	assertTextPresent('Apply 2')
	
	//==== Test if all resumes have been applied
	
	// Go to job page
	open('/')
	clickAndWait('link=Hoang Tran's 1st Job for Dung Nguyen's 1st Resume')
	assertTitle('Hoang Tran's 1st Job')
	
	// Click apply button, should open apply page
	clickAndWait('link=Apply')
	assertTitle('Apply Hoang Tran's 1st Job')
	
	// Don't have any more resume to apply
	assertTextPresent('No more resume to apply.')
	
	*{** Problem here because ID changes after tests
	//===== Test when apply without go through form, should display form
	open('@{InternJobSeekerController.applyJob(1)}')
	assertTitle('Apply Hoang Tran's 1st Job')
	**}*
	
	//==== Test when apply a null resume, should display index
	open('@{InternJobSeekerController.applyJobForm(0)}')
	assertTitle('Home')
#{/selenium}

#{selenium 'Test View Application'}
	
	// Go to a null application, should go back to profile page
	open('@{InternJobSeekerController.viewApplication(0)}')
	assertTitle('Nguyen Tuan Dung')
	
	// Go to resume page
	clickAndWait('link=Dung Nguyen's 1st Resume')
	assertTitle('Dung Nguyen's 1st Resume')
	
	// Go to application page
	clickAndWait('link=Hoang Tran's 1st Job')
	assertTitle('View Application')
	
#{/selenium}

#{selenium 'Test Add Resume'}
	// Open Add Resume page
	clickAndWait('link=Add')
	assertTitle('Add Resume')
	
	type('resume.name', 'Photography')
	type('resume.workExperience', '1')
	type('resume.description', 'Worked in photography business for several clients')
	type('resume.contactInfo.contactEmail', 'me@dungnguyenphotography.com')
	
	// Typing wrong phone format
	type('resume.contactInfo.phone', 'aaaa')
	
	clickAndWait('css=input[type=submit]')
	assertTextPresent('Not a valid phone')
	
	// Typing right phone format
	type('resume.contactInfo.phone', '')
	clickAndWait('css=input[type=submit]')
	
	// Should display resume info page
	assertTitle('Photography')
	assertTextPresent('Worked in photography business for several clients')
	assertTextPresent('me@dungnguyenphotography.com')
#{/selenium}

#{selenium 'Test Update Profile'}
	// Open profile page
	open('@{InternJobSeekerController.profile()}')
	assertTitle('Nguyen Tuan Dung')
	
	clickAndWait('link=edit')
	assertTitle('Update Profile')
	assertTextPresent('Email:')	
	
	// Entering wrong password format
	type('jobSeeker.password', 'abc')
	clickAndWait('css=input[value=Save]')
	assertTextPresent('Minimum size is 6')
	
	// Entering right password
	type('jobSeeker.password', 'dungnguyen')
	
	// Entering more information
	type('jobSeeker.birthday', '1991-09-29')
	type('jobSeeker.contactInfo.mobile', '090-432-9991')
	type('jobSeeker.contactInfo.phone', '043-775-3126')
	
	// Changing contact email
	type('jobSeeker.contactInfo.contactEmail', 'clemenation@yahoo.com')
	
	// Changing about me
	type('jobSeeker.aboutMe', 'Photographer from Hanoi')
	
	// Submit
	clickAndWait('css=input[value=Save]')
	
	// Should return to profile page with success message
	assertTitle('Nguyen Tuan Dung')
	assertTextPresent('Update profile successful!')
	
	// Checking if modified and added fields
	verifyTextPresent('Birthday: 1991-09-29 00:00:00.0')
	verifyTextPresent('Mobile: 090-432-9991')
	verifyTextPresent('Phone: 043-775-3126')
	verifyTextPresent('Contact Email: clemenation@yahoo.com')
	verifyTextPresent('About me: Photographer from Hanoi')
	
	// Edit email this time, will have to login again
	clickAndWait('link=edit')
	type('jobSeeker.email', 'me@dungnguyenphotography.com')
	type('jobSeeker.contactInfo.contactEmail', '')
	clickAndWait('css=input[value=Save]')
	assertTitle('Login')
	
	// Should not logged in
	type('username', 'nguyentuandung2991@gmail.com')
	type('password', 'dungnguyen')
	clickAndWait('css=input[type=submit]')
	assertTitle('Login')
	
	// Using newly changed email
	type('username', 'me@dungnguyenphotography.com')
	type('password', 'dungnguyen')
	clickAndWait('css=input[type=submit]')
	assertTitle('Home')
	
	// Go to profile to check info
	open('@{InternJobSeekerController.profile()}')
	assertTitle('Nguyen Tuan Dung')
	verifyTextPresent('Email: me@dungnguyenphotography')
	verifyTextPresent('Contact Email: me@dungnguyenphotography')
#{/selenium}

#{selenium 'Test Edit Resume'}
	// Editing a resume not on database, should display resumes list page
	open('@{InternJobSeekerController.editResumeForm(-1)}')
	assertTitle('Resumes')
	
	// Submit a resume not on database, should display resumes list page
	open('@{InternJobSeekerController.editResume(-1)}')
	assertTitle('Resumes')

	// Select 'Photography' resume
	clickAndWait('link=Photography')
	assertTitle('Photography')
	
	// Click edit button, should show edit page
	clickAndWait('link=edit')
	assertTitle('Edit Resume')
	
	// Change some info
	type('resume.description', 'Worked hard')
	
	// Entering wrong phone format
	type('resume.contactInfo.phone', 'aaaaa')
	clickAndWait('css=input[type=submit]')
	assertTextPresent('Not a valid phone')
	
	// Correcting phone field
	type('resume.contactInfo.phone', '043-775-3126')
	
	// Submit, should display resume page
	clickAndWait('css=input[type=submit]')
	assertTitle('Photography')
	verifyTextPresent('Worked hard')
	verifyTextPresent('043-775-3126')
#{/selenium}

#{selenium 'Test Delete Resume'}

	//==== Delete normally
	// Go to edit page, should have Delete link
	clickAndWait('link=edit')
	assertTitle('Edit Resume')		
	assertTextPresent('Delete Resume')
	
	// Delete it, should go to profile page and display success result
	clickAndWait('link=Delete Resume')	
	assertTitle('Resumes')
	assertTextPresent('Resume deleted successful')
	assertTextNotPresent('Photography')
	
	
	//==== Deleting resume that already applied
	// Go to edit page of 1st Resume
	clickAndWait('link=Dung Nguyen's 1st Resume')
	clickAndWait('link=edit')
	assertTitle('Edit Resume')		
	assertTextNotPresent('Delete Resume')
	
	
	//===== Delete null resume
	open('@{InternJobSeekerController.deleteResume(0)}')
	assertTitle('Resumes')
	assertTextPresent('Cannot delete this resume')
	
#{/selenium}